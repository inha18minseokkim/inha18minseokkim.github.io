---
title: Branch 전략 논의
date: 2023-10-27
tags:
  - Git
  - 개발
  - 아키텍처
  - CI/CD
category:
  - 기술
---

행내 형상관리 시스템의 변경관리 프로세스와 연계하여 Git Branch 전략을 수립한 내용 정리.

---

### 전제 및 한계점

기존에 운영 중이던 형상관리 시스템을 리뉴얼한 ITSquare의 변경관리 계획 및 절차가 이미 확립되어 있어, 기존 프로세스를 대폭 변경하는 것은 현실적으로 어렵다는 전제 하에 전략을 수립했다.

---

### 기존 형상 프로세스

![이미지](/assets/images/Pasted%20image%2020260227183710.png)

- 요구사항 1건에 대해 N건의 변경계획건 할당 가능.
- 변경계획건 1건에 대해 개발건 N건 변경 가능 (9월부터 적용).
- 변경계획 수정 시 롤백 없이 요구사항 변경을 통해 새로 할당 및 정정하는 방식으로 변경됨 (기존에는 롤백 방식).

---

### Branch 전략

![이미지](/assets/images/Pasted%20image%2020260227183714.png)

| 브랜치 | 역할 |
|---|---|
| `main` | 운영 반영 완료 후 이상 없을 때만 머지. 직접 배포에 사용하지 않음. |
| `CHA` | 변경요청건 단위로 `main`에서 fork. 실제 운영 배포에 사용되는 브랜치. |
| `PKG` | 하위 개발건 단위로 `CHA`에서 분기. 단위 개발 및 테스트에 사용. |

**흐름 요약:**
1. 변경요청건이 들어오면 `main`에서 `CHA` 브랜치를 fork.
2. 각 하위 개발건에 대해 `PKG` 브랜치를 할당하여 개발 서버에서 단위 테스트 수행.
3. `PKG`를 `CHA`에 주기적으로 커밋하고, 스테이징 환경에서 통합 테스트 진행.
4. 검증 완료 후 `CHA` 브랜치를 운영 파이프라인을 통해 배포.

---

### 문제점

**1. 동시 다건 CHA 브랜치 간 소스코드 불일치**

여러 `CHA` 브랜치가 동시에 존재하고 배포 시점이 다른 경우, 각 브랜치 간 소스코드가 맞지 않는 상황이 발생할 수 있다. 이 경우 먼저 운영에 반영된 `CHA` 브랜치를 아직 개발 중인 `CHA` 브랜치에 머지해야 하는 작업이 필요해진다. 이를 방지하려면 가급적 `CHA` 브랜치가 동시에 여러 건 존재하지 않도록 일정을 조율하는 것이 중요하다.

**2. 프로젝트 수 증가에 따른 문서 작업 부담 증가**

프로젝트 수가 늘어남에 따라 변경계획 관리 및 개발 문서 작업량이 함께 증가했다. `pod : project : 변경계획`이 `1:1:1` 구조인 이상, 코드 영향도 격리와 로직 독립성을 위해 프로젝트를 분리하고 싶어도 문서 부담 때문에 무조건적인 분리는 현실적으로 어렵다.

---

### Main 브랜치를 운영 배포에 직접 사용하지 않는 이유

기존 형상 프로세스를 유지해야 하기 때문이다. 운영 반영 후 문제가 발생했을 때 마지막으로 배포된 `CHA` 브랜치를 추적하는 것이 현실적이며, `main`에 직접 반영하면 `CHA`와 `main`이 100% 동일하다고 보장하기 어렵다.

→ [결재 반려 시 GitLab branch delete 이슈]({% post_url 2023-12-20-결재 반려 시 gitlab branch delete 이슈 %})
