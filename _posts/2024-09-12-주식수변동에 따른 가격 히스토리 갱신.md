---
title: "주식수변동에 따른 가격 히스토리 갱신"
date: 2024-09-12
tags: [미지정]
category: 재테크
---

### ASIS

현재 매일 1년치 데이터 upsert 중
사유 : 주식수량이나 권리 변동 관련한 이벤트 발생하는데 어떤 종목이 이벤트가 발생하는지 대응할 방법이 현재는 없음
  - 공시기준으로 주식분할결정 유무상증감자 긁어낼 수 있으면 가능은 한데 효력발생일 기준으로 또 파싱하고 해야함
TOBE(희망사항)
일 데이터 기준으로 주식수량 변동되면 해당 종목은 N년(필요한만큼) upsert 하는것이 우선 최선인듯.


```java
"data": [
        {
            "date": "2018-02-12",
            "symbol": "005930",
            "name_ko": "삼성전자",
            "name_en": "SamsungElec",
            "dividend_yield": 62.33596,
            "dps": 28500.0,
            "eps": 157967.0,
            "par_value": 5000.0,
            "bps": 1156530.0,
            "trading_halted": false,
            "shares_listed": 128386500,
            "per": 0.2894275,
            "pbr": 0.03953205
        }
```


```java
"data": [
        {
            "date": "2024-09-12",
            "symbol": "005930",
            "name_ko": "삼성전자",
            "name_en": "SamsungElec",
            "dividend_yield": 2.177979,
            "dps": 1444.0,
            "eps": 2131.0,
            "par_value": 100.0,
            "bps": 52002.0,
            "trading_halted": false,
            "shares_listed": 5969783000,
            "per": 31.11215,
            "pbr": 1.274951
        }
    ]
```



### 한화증권 케이스

예상한대로 코스콤이랑 sftp 전용선 이런식으로 통신하겠지만, 종가 기준으로 유통 주식 수량이나 액면가 같은 데이터가 다르다면 해당 종목 재적재한다고 함.


### 현재 문제점

1. 딥서치 상대기관의 api 서버가 감자서버라 1년 이상 가격을 호출하면 뻗어버림. 1년 미만도 자주 호출하면 뻗어버림. 
2. 그러면 페이징 처리 감성으로 1년단위로 끊어오면 되긴하는데 알겠지만 현재 내부망 + EAI 이슈로 카프카를 사용중이라 페이징 호출 로직을 짜는게 조심스럽다. 
  1. 만약에 개선한다고 하더라도 지금 만들어놓은 프로젝트는 폐기하고 새로 퍼블릭망에서 구축하는것이 적절하다고 생각한다.
그래서 일단 데이터는 3개월치만 무조건 upsert로 구현한 다음 딥서치에서 제공해준 기간별 집계 api를 호출하고 캐싱하여 사용하는걸로..
