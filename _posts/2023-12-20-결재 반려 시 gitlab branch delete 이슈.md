---
title: "결재 반려 시 GitLab Branch Delete 이슈"
date: 2023-12-20
tags:
  - Git
  - 개발
  - 이슈정리
category:
  - 실무경험
  - 기술
---

형상관리 시스템(ITSquare)과 GitLab 연동 과정에서 결재 반려 시 CHA 브랜치가 삭제되는 이슈 정리.

---

### 문제 상황

ITSquare의 통합테스트 또는 사용자테스트 단계에서 **변경계획 단계로 반려**가 발생하면, ITSquare GitLab Bot이 GitLab API를 통해 CHA 브랜치를 자동으로 삭제한다. 이후 부서장 결재가 완료되면 CHA 브랜치가 재생성된다.

문제는 재생성된 CHA 브랜치가 **초기 `main` 브랜치와 동일한 상태**(개발 내용 없음)로 생성된다는 점이다. 개발자 입장에서는 이미 개발을 완료한 상태에서 변경계획 단계의 일부 사항만 정정하고 다시 승인 → 개발 → 통합테스트 → 사용자테스트 순서로 진행하게 되는데, 이 시점에 형상 문서가 참조하는 CHA 브랜치에 아무런 내용이 없어 **배포 파이프라인이 오류를 발생**시킨다.

---

### 원인 분석

**정상 케이스 (통합테스트 → 개발 반려):**
- 개발 완료 후 PKG 브랜치를 CHA에 머지한 뒤 PKG 브랜치를 삭제하는 것은 의도된 동작.
- 통합테스트에서 개발 단계로 반려되는 경우, 새로운 PKG 브랜치를 CHA에서 다시 fork하면 되므로 문제없음.

**문제 케이스 (통합테스트 → 변경계획 반려):**
- 변경계획 단계로 반려될 때 CHA 브랜치 자체가 삭제되므로, CHA에 머지되어 있던 개발 내용이 함께 사라진다.
- PKG 브랜치에 머지되지 않은 개발 내용도 PKG 삭제 시 함께 소실될 수 있다.

**ITSquare 측 설계 의도:**
- ITSquare는 변경계획 단계로 돌아갈 때 해당 건이 신규 건인지 반려된 건인지 구분하지 않고, 변경계획 단계 진입 시 CHA를 항상 신규 생성한다고 가정하여 기존 브랜치를 삭제하는 방식으로 구현되어 있다.
- 결국 형상관리 시스템과 GitLab 연동 구조상 발생하는 설계 한계로, **반려 시에는 CHA 브랜치를 삭제하지 않고 유지**하는 것이 적절하다. 재생성 시 브랜치가 이미 존재하면 409 Conflict가 발생하므로, 이를 기준으로 기존 브랜치를 재사용하도록 처리하면 된다.

---

### 해결

해당 이슈를 정리하여 기획팀에 전달했으며, ITSquare 연동 개발사에서 유지보수를 통해 수정하기로 했다. 수정 완료 전까지는 변경계획 단계 반려 시 개발 내용 보존 여부를 별도로 확인하는 방식으로 대응한다.
