---
title: "결재 반려 시 gitlab branch delete 이슈"
date: 2023-12-20
tags: [미지정]
category: 기타
---

### 문제 상황

ITSquare 통합테스트 및 사용자테스트 단계에서 변경계획단계로 반려 시 CHA Branch 삭제, 부서장 결재 후 CHA Branch 재생성됨
ITSquare Gitlab Bot이 CHA Branch를 삭제하는 것 확인(변경계획단계로 반려 시 ITSquare에서 gitlab에 Branch 삭제 api 날리는것 확인)
문제는 개발자 입장에서는 개발 다 하고 변경계획단계에서 몇가지 사항만 정정하고 다시 승인→개발→통합테스트→사용자테스트 로 다시 넘어온 시점에 해당 형상문서가 물고 있는 CHA Branch에 아무것도 없는데(Readme.md, 초기 main branch와 똑같은 해시 버전 있음) 파이프라인이 작동하면서 에러 일으킴

### 사유

기존에 개발 완료 → 통합테스트로 넘어가는 경우 PKG branch 삭제하는것은 의도된 사항(개발 완료하고 통합테스트를 하는것이니 PKG를 CHA에 merge 후 삭제)
통합테스트에서 개발로 반려되는 경우 새로운 PKG Branch를 CHA에서 부터 FORK
  - → 그러므로 여기까지는 문제 없음
  - 문제있는게 하나 있는데 개발단계에서 개발 하다가 CHA에 MR 없이 변경계획으로 반려하면 반영되지는 않았지만 PKG에 있는 개발내용들이 다 사라지지 않나 이건 알아봐야함
변경계획단계로 반려하는 경우 생기는 문제 → CHA에 MR 되어있던 내용들이 반려와 함께 다 사라질 수 있음
그러면 왜 반려할 때 CHA를 삭제하도록 만들어졌나?
  - ITSquare 입장에서는 변경계획단계에서 채번되는 CHA가 새로 들어온 건인지, 반려된 건인지 모르기 때문에 변경계획단계에서 무조건 생성한다고 보고 반려칠때 다 지우는 것이라 함
결국  gitlab이 기존 형상시스템과 연계(컴플라이언스 대응)를 하면서 발생하는 문제인것같음
반려할 때 CHA branch를 유지하는게 맞지 않나라는 생각. 만들 때 중복되면 어차피 409 발생하니

### 해결

해당 요건은 기획팀에 정리해서 드렸고
ITSquare 연동개발한 업체가 유지보수 다시 해줘야한다고 함
당분간은 조심하면서 써야함 ㅋㅋㅋㅋ 

