---
title: "새로운 이슈(파일 크기 OOM)"
date: 2024-04-04
tags:
  - HTTP
  - 개발
  - 이슈정리
category:
  - 실무경험
  - Network
---

[EAI openApi 데이터 수신 관련]({% post_url 2023-12-18-EAI openApi 데이터 수신 관련 %}) 포스트에서 이어지는 내용.

---

### EAI 구간 OOM 이슈

`Pod → EAI → openApi → 외부` 흐름에서 소용량 데이터는 실시간 통신이 정상 동작했으나, **3.8MB 이상의 응답 바디**에서 EAI 구간에 OOM이 발생했다.

**원인**: EAI 통신 시 DB 로깅 과정에서 base64 인코딩을 수행하는데, 이 구간에서 데이터 크기가 증폭되어 메모리 초과가 발생하는 것으로 파악됨.

**제약 사항**:
- 2MB를 초과하는 전문은 File 전송 방식으로만 처리 가능.
- HTTP 스펙 자체에는 문제가 없으나, EAI 솔루션의 내부 처리 한계로 인한 제약.
- 대용량 응답이 예상되는 API의 경우 사전에 응답 크기를 확인하고, 필요 시 페이징 처리로 1MB 미만으로 분할 수신해야 함.

> **후속 조치 (2024-07-02)**: 이 제약으로 인해 해당 데이터 수신 구간을 EAI 대신 Kafka 기반으로 전환하기로 결정.

---

### 보안성 심의 리스크

행내에서 외부 API를 통해 데이터를 수신하려면, openApi 솔루션 담당팀의 방화벽 작업과 정보보호팀의 보안성 심의를 사전에 통과해야 한다. 이 과정에서 아래와 같은 현실적인 제약이 있었다.

**심의 과정에서 제기된 주요 질의:**
1. 애플리케이션 레벨 DB 로그 보유 여부
2. 외부에서 수신하는 파일에 악성코드가 포함된 경우의 대응 방안

두 항목 모두 기술적으로 답변 가능한 사안이었으나, 심의 완료 시점이 실제 오픈 당일에 맞춰지는 경우가 많아 **운영 데이터를 사전에 검증할 수 없는 구조적 문제**가 발생했다.

**실제 발생한 문제 (비상장주식 서비스 오픈 사례):**

| 시점 | 상황 |
|---|---|
| 목요일 내부 오픈 | 운영 데이터 최초 수신 |
| 오픈 직후 | 외부 파트너사 측 쿼리 오류로 데이터 이상 확인, 정정 요청 |
| 금요일 오후 | 데이터 정상 수신 확인, 테스트 환경에서 미발견된 이상 패턴 발견 → 긴급 메타 반영 |
| 이후 | 음수 변동률 처리 시 MCI 길이 초과 이슈 확인 → 긴급 배포 |

운영 오픈 전 충분한 검증 기간이 확보되지 않으면 위와 같이 오픈 직후 긴급 대응이 연쇄적으로 발생할 수 있다.

---

### 외부 API 유형에 따른 개발 환경 차이

**공공 데이터 API (e.g. 공공데이터포털 등록 기관)**
- 퍼블릭 IP로 접근 가능하므로 로컬 환경에서 사전 개발 및 충분한 테스트 수행 가능.
- 보안성 심의 결과가 늦더라도 자체 방화벽 이슈만 남아 비교적 리스크가 낮음.

**IP 필터링이 적용된 외부 파트너 API**
- 파트너사 측에서 케이뱅크 서버 IP만 허용하기 때문에 로컬 개발 환경에서 직접 호출이 불가.
- 사용 가능한 환경 조합이 `파트너 테스트 → 행내 테스트` / `파트너 운영 → 행내 운영`으로 제한됨.
- 테스트 환경에서 충분히 검증하지 못하면 운영 오픈 후에야 데이터 이상을 인지하게 되는 리스크가 있음.
- **사전 API 명세 검토와 테스트 환경에서의 충분한 검증이 특히 중요.**
