---
title: "새로운 이슈(파일 크기 OOM)"
date: 2024-04-04
tags: [미지정]
category:
  - 기타
---
pod → EAI → openApi → 대외 → openApi 까지는 성공. 작은 파일은 실시간 통신 가능. Http body부의 길이 제한은 거의 없지만 데이터가 3.8mb 이상 넘어가는 순간부터  EAI 구간에서 oom 발생. EAI 통신 시 DB 로깅하는 부분에서 데이터가 커지는 경우 문제 생김.
  - ~~기준정보를 api로 받는 경우 1메가가 넘는다 라고 이야기를 하니 온라인성 거래가 왜 1메가가 넘냐 그건 페이징 처리 안한게 잘못한거다 라고 이야기하는데 하.. ~~
2메가를 넘는 전문의 경우 file 방식으로 강제됨(ㅜㅜ)
아마 로깅 시 base64 인코딩하는 구간에서 파일이 커지는 구간이 있는데 거기가 문제라고 함.
사실 body가 2메가 넘는 온라인 케이스가 잘 없긴 할듯. 하지만 HTTP 스펙 상 문제될것은 없는데 EAI가 문제이므로 api 스펙을 잘 확인해야 함.
  - ⇒20240702 이것 때문에 기존 EAI 대신 Kafka 사용하기로 함.

## 보안성심의 리스크

현재 케이뱅크 행 내에서 openApi를 활용하여 대외에서 데이터를 수신하는 경우 openApi 솔루션 담당자의 방화벽 작업과 함께 정보보호팀의 보안성심의를 받아야함
문제는 이게 상당히 오래걸린다. 개인적인 느낌으로는 검사하고 이런게 많아서가 아니라 그냥 잡고있는것같음.
  1. 어플리케이션에서 DB 로그를 가지고 있냐고 물어봄.
  2. 대외에서 들어오는 파일에 악성코드가 있으면 어떡하냐
  3. 오픈 당일날 해줌
이런 레퍼토리인데 
  1. 백엔드 개발자가 스프링부트 해봤자 nginx 정도 협의해서 건들텐데 DB로그는 우리 수준에서 가져올 수 없다 아니 그건 애초에 DBSafer 로그일텐데 DBSafer는 정보보호팀 소관아닌가 → 일단 전달함.
  2. 그렇게따지면 금감원 타기관에서 들어오는 파일들 다 전수조사 거쳐야함. 들어온다 하더라도 이건 정보보호팀이 해결할 문제 아닌가 → 이건 차마 전달 못함.
  3. 협조적이지 않으시다. 바쁘셔서 그런거라고 믿고 있다.
1번 2번의 경우 어떻게든 할 수 있지만
3번의 경우 이행계획서 Tech,Dev실장 결재가 나고 운영에 적용되고 나서야 해준다는 느낌을 강하게 받음. 딱히 관련 규정은 없음.

이렇게 되었을 때 문제점이 있음.
1. 상대 기관 운영데이터를 오픈이 되고 나서야 볼 수 있음. 내부 임직원용 오픈이기는 하지만 운영서버 오픈과 동시에 데이터를 보면 해당 데이터 검증 불가
2. 검증 불가이기 때문에 수정을 하려면 긴급배포요청을 해야함
3. 목요일 내부오픈 화요일 대고객 오픈 이런식으로 일정을 많이 짠다
  1. 이번에 비상장주식 서비스 오픈 하면서 목요일날 오픈 > 데이터 받아봄 > 두나무에서 쿼리 잘못짜서 데이터 정정요청함(현재 운영 이행상태, 아무것도 못함)
  2. 금요일날 오후에 데이터 정상 수신확인함 > 테스트 데이터에서 보지 못한 패턴 발견(+599만 % 같은) > 긴급 메타 반영 
    - 이것도 결국에는 결재 해주기 전까지 아무것도 못함
  3. 테스트 하다가 MCI 길이 이슈 확인 > 음수 변동률이 큰 경우 MCI 에서 제대로 담지 못하고 있었음 > 긴급 복사배포
  4. 처음부터 잘  캐치했어야지 라는 이야기를 들으면 조금 화가 날 수도 있을듯 하다.
기존 오늘의 생활시세 식품물가 탭의 경우 한국농수산식품유통공사가 공공데이터포털에 등록해놓았기 때문에 public ip로 접근이 가능해서 로컬(회사로컬 말고 내 서피스)에서 개발 수행하고 회사 리소스로 반입함. 보안성심의를 오픈날 알려주더라도 우리쪽 방화벽 이슈만 있지 나머지는 이슈가 없음.
  - 1년치 데이터를 충분히 로컬에서 테스트 해봤기 때문에 이슈가 거의 없었음. 
비상장 같은 경우는 두나무 쪽에서도 IP 필터링을 하기 때문에 내 로컬에서는 개발이 불가능하다. 사실상 상상코딩의 영역
  - 두나무 테스트 > 케뱅 테스트 
  - 두나무 운영 > 케뱅 운영 이렇게 두 가지 밖에 안됨
    - (두나무 운영 > 케뱅 테스트 불가, 상대 기관 정책)
그러므로 테스트 서버에서 테스트를 잘 해야되는데 1. 두나무가 운영에 데이터 잘못쌓고있었음 2. 그걸 우리는 2주가 지난 4월 18일이 되어서야 알았음 3. 그리고 우리쪽 검증을 시작
  - 아마 두나무 입장에서도 2주 지나고 나서 뒷북치는걸 보고 어이가 없었을지도..
