---
title: 의존 객체 주입
date: 2023-09-08
tags:
  - 개발
category: 기술
---

## 선정리 및 결론

디커플링을 수행하기 위해서는 해당 객체가 최대한 stateful하지 않게 만들어 주는것이 좋다.
저장하는 데이터도 없고, 내부에서 상태가 변함에 따라 입출력 값의 관계가 변하지 않는것(함수에 해당하는 이야기, 객체는 어렵다) 
→ 그러므로 객체 내부에서 만들지 말고 내부에서 사용해야 하는 모듈도 input으로 두자(의존성 주입) 

```java
public class SpellChecker {
	private staic final Dictionary dictionary = new Dictionary();
	private SpellChekcer() {}
	public static boolean isValid(String record){
		return dictionary.contains(word);
	}
	public static List<String> recommend(String typo) {
		return dictionary.closeWordsTo(typo);
	}
}
```

내부에서 사용할 객체를 생성하는 패턴 - 생성할 때 마다 딕셔너리 만듬. 객체 생성 시점에 객체가 만들도록 하지 말고 프로그래머가 가지고 있는 리소스에 따라 다른 동작을 원한다면 외부에서 주입하는것이 맞음. → 리소스에 따라 다른 동작을 한다면 SpellChecker를 여러 종류 만들어야 함(new EnglishDictionary 에는 EnglishSpellChecker 이런식으로..)

```java
public class SpellChecker {
	private final Dictionary dictionary;
	public SpellChecker(Dictionary dictionary){
		this.dictionary = dictionary;
	}
	public static boolean isValid(String record){
		return dictionary.contains(word);
	}
	public static List<String> recommend(String typo) {
		return dictionary.closeWordsTo(typo);
	}
}
```

생성자 호출 시점에 외부에서 원하는 딕셔너리 객체를 주입하면 해당 딕셔너리의 세부적인 동작에 따라 유연하게 동작 가능(영어사전,한국어사전,스페인어사전 등 사전만 바꿔치면 됨)
만약 여기서 사전이 인터페이스라면

```java
public interface Dictionary {
	boolean isValid(String record);
	List<String> closeWordsTo(String typo);
}
```

세부적인 객체를 implement 한 객체들을 구현해서 주입 가능

생성자 객체 주입 시 해당 객체의 팩토리를 넘겨줘도 됨

```java
public SpellChecker(DictionaryFactory dictionaryFactory){
	this.dictionary = dictionaryFactory.get();
}
```

이런식으로 한번 더 추상 레이어를 거치면 더 유연함
다만 구현이 복잡하니 복잡한 객체에서 사용하는게 나을듯
Supplier로도 구현 가능

```java
public SpellChecker(Supplier<Dictionary> dictionarySupplier) {
	this.dictionary = dictionarySupplier.get();
}
```

테스트코드에서 다음과 같이 구현 가능

```java
SpellChecker spellChecker = new SpellChecker(() -> {
		return new DefaultDictionary();
	}
)
//또는
SpellChecker spellChecker2 = new SpellChecker(DefaultDictionary::new);
//팩토리를 사용한다면
SpellChecker spellChecker3 = new SpellChecker(DictionaryFactory::get);
```


	[개인적인 생각 with Facade(20230910)]({% post_url 2023-09-10-개인적인 생각 with Facade(20230910) %})