---
title: 개인화정보 캐싱 전략
date: 2025-05-30
tags:
  - 주식서비스
  - 기술
  - 개발
  - 아키텍처
category:
  - 실무경험
  - 주식둘러보기
---

메인 화면 진입 시 노출되는 "최근 본 종목" 카드의 캐싱 전략 검토 내용.

---

## 요건

메인 화면에 처음 진입하면 고객이 **최근 1주일 이내에 조회한 종목(최대 30개)** 과 함께, 조회 당시 가격 대비 현재 가격의 변동률(%)을 카드 형태로 노출해야 한다.

---

## 규모 추정

DAU 약 60만 기준으로 메인 화면 진입 시 발생하는 호출량은 일 약 **200만 건** 수준으로 추산된다.

- 캐싱 없이 구현하려면 단일 쿼리로 모든 데이터를 처리해야 하는데, 이 규모에서는 현실적으로 어렵다.
- 설계 원칙으로, 서브 도메인 간 인프라 직접 연동보다는 **서비스 레이어의 API 조합** 방식을 우선 검토한다. (코드 간결성 및 유지보수 용이성)

---

## 데이터 레이어 분석

화면을 구성하는 데이터는 아래 세 가지 레이어로 구분된다.

```
고객의 최근 조회 종목 30개
  └─ 각 종목의 조회 시점 가격
  └─ 각 종목의 현재(최신) 가격
      └─ 변동률 = (현재 가격 - 조회 시점 가격) / 조회 시점 가격
```

- **최신 가격**: 다른 API에서도 공통으로 사용되므로 이미 충분히 캐싱되어 있음.
- **조회 시점 가격**: 업무 단위별로 별도 캐싱이 필요. 캐시 공간 관리를 위해 노출 기간을 최근 1주일로 제한.

따라서 **7일치 시장 데이터(국내 약 2,700종목 + 해외 약 6,000종목 + ETF 약 1,500종목)** 를 추가로 캐싱해야 한다.

---

## 캐싱 방식 검토

**방안 1. `(티커, 기준날짜)` 단위로 캐싱**

종목과 날짜의 조합을 캐시 키로 사용. 특정 종목·특정 날짜의 가격을 직접 조회할 수 있어 단건 조회에 효율적이다.

**방안 2. `(기준날짜)` 단위로 티커 리스트 캐싱**

날짜를 캐시 키로 하고, 해당 날짜의 전체 종목 리스트를 값으로 저장. 이후 필요한 종목만 리스트에서 추출하여 사용한다.

---

## 협의 필요 사항

개인화 히스토리 정보의 캐싱 처리 주체를 사전에 합의하는 것이 좋다.

**이상적인 흐름 (채널 레이어 처리):**
1. 고객이 종목을 조회할 때마다 채널(프론트엔드)에서 해당 시점의 가격 정보와 종목 정보를 캐싱.
2. 메인 화면 진입 시 캐싱된 히스토리와 최신 가격을 조합하여 변동률 계산 후 노출.

채널 측에서 처리하는 것이 이상적이나, 일정 또는 구현 상 제약이 있는 경우에는 **mediation 레이어에서 API를 조합**하는 방안으로 대응한다.

### 협의 결과

채널 로컬 스토리지에서 캐싱한 내용을 사용하기로 결정