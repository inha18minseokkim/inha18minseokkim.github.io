---
title: MockBean
date: 2023-10-01
tags:
  - 개발
  - Spring
category:
  - 기술
---

### 문제상황

요약 : 분명히 되는건 안다(이게 없으면 단위테스트를 어케함)
그러나 방법을 몰라.. 찾다가 시간다감
Batch 실행을 위해 Step과 Job을 @Configuration에 @Bean등록 
등록 후 @SpringBootTest를 활용하여 테스트 관련 빈을 자동으로 주입 받고 테스트를 하려함
모든 빈을 로딩 하려고 함
그래서 @Configuration에 등록되어있던 Step이 실행되는 현상 발생
단위테스트 돌리려고 할 때 마다 모든 Step이 깨어나서 무거운 작업을 하려함

해결방법
처음 해결 방법 - TestConfiguration을 만들어 해당 빈을 제외하고 다 등록하려함
문제점 - 겁나 귀찮고 할일 많음. 테스트 할 때 빈 추가되면 또 Configuration에 빈 추가 해야함. 그리고 관련된 빈들을 다 찾기도 힘듬
두 번째 해결 방법 - @SpringBootTest 할 때 Exclude 하려 함
문제점 - 이것도 위랑 비슷함.

그러다 찾음 @MockBean을 주입
아무것도 안하는(어차피 필요없음) 가짜 객체 만들어서 테스트 할 때 넘겨주면 스프링 컨텍스트는 그냥 있는줄 알고 알아서 넘어가려 함.

```java
@SpringBootTest
@MockBean(classes = {DefaultAnnouncementApiReceiveStepConfig.class})
class AnnounceDefaultMapperTest {

    @Autowired
    AnnounceDefaultMapper announceDefaultMapper;

    @Test
    public void stringToLocalDate() {
        LocalDate tempLocalDate = LocalDate.parse("20230814", DateTimeFormatter.ofPattern("yyyyMMdd"));
        System.out.println(tempLocalDate);
    }
    @Test
    public void defaultMappingTest(){

        //{"corp_code":"00126380","corp_name":"삼성전자","stock_code":"005930","corp_cls":"Y",
        // "report_nm":"동일인등출자계열회사와의상품ㆍ용역거래변경","rcept_no":"20230814001577","flr_nm":"삼성전자","rcept_dt":"20230814","rm":"공"}
        AnnounceDefaultElement testObject = AnnounceDefaultElement.builder()
                .corp_code("00126380").corp_name("삼성전자")
                .stock_code("005930").corp_cls("Y")
                .report_nm("동일인등출자계열회사와의상품ㆍ용역거래변경")
                .rcept_no("20230814001577").flr_nm("삼성전자")
                .rcept_dt("20230814").rm("공").build();
        AnnounceDefault announceDefault = announceDefaultMapper.from(testObject);
        System.out.println(announceDefault.toString());

    }
}
```


이런식으로 heavy하고 해당 테스트에서 관련 없는 기능들에 가짜 빈 주입을 해서 안에 코드가 실행되지 않도록 하면 깔끔하다