---
title: "다중 파티션 고도화"
date: 2024-09-09
tags: [미지정]
category:
  - 기타
---

### 다중 파티선 필요 사유/ 기존 요건

기존에는 1 topic - 1 partition 이면 된다고 생각했다고 함
  - 왜냐하면 pubjob에서 찌르고 consumer 인스턴스가 데이터를 어떻게 하기만 하면 된다고 해서
    - +) 뭔가 순서보장을 생각하셨던것같음
문제는 “어떻게 하면” 이 상당히 길어지다 보니(db upsert) consumer 인스턴스를 늘려야 한다.
  - unique index 기준으로 격리된 토픽이다 보니 인스턴스 늘리면 적재성능 올라갈 것으로 판단


### 어차피 순서보장 잘 못함

상장주식데이터 producer → kafka → openApi → kafka → 상장주식데이터 consumer에서 다중 메세지를 pub 할 때 순서 보장이 되려면 consumer에서 적재, commit, ack 후  pub하는 카프카와 상당히 맞지 않는 로직이 됨. ⇒ 말안됨
아니면 openApi 커넥션풀이 하나여야 말이 되는데 이것도 말이 안됨. ⇒ kafka sub 배치로 N건 한 다음 openApi에서 병렬로 request 하고 응답값 pub 할 텐데 순서보장 안됨. 되도록 로직을 만든다고 하더라도 그러고 싶지 않음.
결론, 순서보장 할거면 커넥션이 되는 EAI로 하자. 끝.
  - ~~물론 EAI를 쓰면 1메가가 넘는 전문은 뻑이 간다. 선택의 여지가 없다~~
일단 이번 개발건과 앞으로의 개발건의 대부분이 순서보장이 필요한 건이 아니고 가급적이면 순서와 관계없도록 업무를 설계할 예정이므로 파티션 늘려도 됨.
그러므로 Throughput을 향상시키기 위해 파티션을 늘려달라 함.




