---
title: "메세지큐 기반 알림 서버 설계 고민"
date: 2025-01-20
tags: [Spring, 백엔드, 아키텍처, 메세지큐, Java]
---

알림 발송 서버를 만들면서 설계 고민을 정리한 내용.

## 요구사항

1. 예약발송, 즉발 모두 지원
2. 요청이 들어오는 대로 날려
3. DB 접근 기술을 JPA를 사용하므로 스레드 기반 모델 채택

## 기본 흐름

요청이 들어오면 큐에 넣고, 별도의 스레드가 이벤트 리스닝을 하고 있다가 처리한다.

```
요청 → 큐(BlockingQueue) → 리스너 스레드 → 알림 발송
```

## DB 필드 설계 고민

수신자 정보를 어떻게 저장할지가 고민이었다.

**방법 1: 카톡ID, 번호, 이메일 각각 컬럼으로**
- 좋은 점: DB 설계가 간단
- 나쁜 점: API에서 요구하는 필드가 달라지면 스키마 변경 필요

**방법 2: 식별자 + JSON 원본을 통째로 저장**
- 좋은 점: 유연성이 높고, 어떤 채널 API도 수용 가능
- 나쁜 점: RDB에 jackson으로 풀어헤치는 방식이라 쿼리하기 불편

**절충안**: 컨트롤러 V2를 만들어서 V2부터는 JSON 원본 방식으로. 기존 V1은 그대로 유지.

결론: **그냥 일단 원본 넣어보자**

---

## 알림 발송 서버 설계 원칙

실제 구현할 때 우선순위:

1. 대량 발송 요청의 경우에도 오류 응답 없이 처리 가능
2. 알림이 발송된 순서대로 발송
3. 알림발송서버 장애 시 후처리 가능

BlockingQueue + Enum으로 채널 타입을 관리하고, 각 채널(카카오, SMS, 이메일)에 대한 팩토리 패턴으로 구현하면 깔끔하게 확장이 가능하다.

---

## 남은 과제

- `async` 실행한 프로세스 죽이는 방법 확인 필요
- 예약발송의 경우 스케줄러 vs 큐 방식 트레이드오프 정리 필요
