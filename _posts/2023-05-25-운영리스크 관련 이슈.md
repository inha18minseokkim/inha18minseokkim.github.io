---
title: 운영리스크 관련 이슈
date: 2023-05-25
tags:
  - 생활시세
  - 기획
  - 이슈정리
  - 케이뱅크
category:
  - 실무경험
---

### 중간에 데이터 피드가 끊겨버리는 경우 

ex) 분류코드,품목코드,도매소매구분,종류코드,등급코드로 구분된 특정 한 품목이 더 이상 가격정보를 제공하지 않아 사용자에게 다른 가격을 제공해야하는 경우가 생김


### 해결방안

현행 : 내부상품대분류코드,분류,품목,도매소매구분,종류,등급코드 - 내부상품명으로 일대일 매핑. 만약에 해당 품목이 더 이상 피드되지 않을 경우 새로운 코드로 대체할 경우 데이터가 끊기는 경우 생김
1. 해당 품목과 똑같은것 ex)건미역 상품 중품 을 모두 group by avg를 해서 최대한 리스크를 낮추자
  - → 문제점 :  많은 품목을 기준으로 평균 산출 시 가격 신뢰성, 가격변동이 잘 안될 수 있음. 추가되는 코드에 대해서는 어차피 대응못함. 수동 추가 해야함.
2. 관리테이블을 따로 만들어 통계평균때릴때 in절 넣어서 여러 상품을 모두 가져와서 baseDT 기준으로 평균넣어 돌림
  - 예시 : 테이블을 하나 만들어서 (100,111,01,01,04)와 내부상품코드로 하나 등록. 만약 해당 상품이 없는 경우 (100,111,01,01,05)를 새로 추가함. 통계배치를 돌릴 때 IN을 걸어 두 상품 모두 가져와서 데이터가 끊기는 후에는 05를 사용하여 평균을 내도록 함
  - 논의해봐야 할 점 : 경우에 따라 다르지만 위 사항은 새로운 코드를 추가하는 경우에는 100% 정확한 방법(기존에 코드가 없어 이전 데이터가 없음). 기존에 수집되고 있던 코드를 사용테이블로 편입하는 경우 이미 있던 통계정보와 싱크가 맞지 않을 수 있음(기존에는 04만 통계를 때리다가 후에 04 05 둘 다 통계에 반영됨) 따라서 추가적인 로직이 필요한데 아마 데이터간 우선순위를 둬서 날짜별로 하나씩만… 이러면 너무 복잡해지는듯.
3. 내부상품소분류코드 추가
  - 개편 : 자체코드(가칭 내부상품소분류코드)를 추가하여 (내부상품대분류코드,내부상품소분류코드) - (분류코드,품목코드,도매소매구분코드,종류코드,등급코드) - (내부상품명)으로 일대일매핑을 함. 즉 (내부상품대분류코드,내부상품소분류코드) - (내부상품명) 으로 노출품목을 관리하고  (분류코드,품목코드,도매소매구분코드,종류코드,등급코드) 로 구성된 가격정보가 만약 더이상 제공되지 않는다면 
  - 예컨데 (100,111,01,01,04) 가 더이상 제공되지 않는다면 (100,111,01,01,05)로 대체하여 피드 진행.
  - → 영향도 : 서비스 화면에 노출되는 데이터가 있는 테이블은 통계테이블. (100,111,01,01,04)로 통계처리되어있는 테이블을 (100,111,01,01,05)로 모두 바꿔야하는 상황 발생. + 현재 통계 테이블의 경우 코드정보와 dependency가 상당히 크기 때문에 코드정보가 바뀌는경우 상당한 문제가 있다.
  - → 해결방안 : 통계테이블에서 pk를 (기준일자,도매소매구분코드,상품범주코드,상품품목코드,상품종류코드,상품등급코드,지역코드,기간명)으로 잡을게아니라(기준일자,내부상품대분류코드,내부상품소분류코드,지역코드,기간명)으로 잡고 채널에서 내부상품 기준으로 조회를 태우면될듯
  - 논의해봐야 할 점 : 위 사항은 중간에 품목이 바뀌는 경우 데이터를 이어서 보여줘야하는 경우를 가정하고 운영측면에서 리스크를 최소화하기 위한 방법임. 애초에 (100,111,01,01,04) 쌀 상품 품목이 (100,111,01,01,05) 쌀 중품 품목으로 바뀔 때 그냥 피드 종료하고 새 상품 만들어서 보여줘도 되긴 함. 다만 관심상품목록에 추가가 되어있는 경우 이걸 바꿔치기 해도 되나? 싶은것. 아마 바꿔치기 하면 상세설명 column에 이때 이후로 가격 한번 바뀌었어요 와 같이 설명 필요할듯.

