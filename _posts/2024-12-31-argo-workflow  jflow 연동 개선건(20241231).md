---
title: Argo Workflow + JFlow 연동 시 로그 문제 해결
date: 2024-12-31
tags:
  - Kubernetes
  - Argo
  - 인프라
  - 개발
  - CI/CD
  - 케이뱅크
category:
  - 기술
---

JFlow에서 Argo Workflow를 실행할 때 발생하는 **로그 사이즈 폭증 문제**와 **실제 작업 로그가 안 보이는 문제**를 해결한 경험을 정리한다.

---

## 문제 상황 (AS-IS)

기존에는 다음과 같이 `--watch` 옵션만 사용하고 있었다.

```bash
argo submit loop-sequence.yaml --watch
```

### 문제점

![기존 watch 옵션 화면](/assets/images/Pasted%20image%2020260228171341_2b0bae93.png)

`--watch` 옵션을 사용하면 **1초마다 워크플로우 상태가 갱신**되면서 출력된다. 이로 인해 두 가지 문제가 발생했다:

1. **로그 파일 사이즈 폭증**: 8시간 이상 실행되는 작업의 경우 로그가 **270MB 이상**으로 커짐
2. **JFlow 작업 실패**: 로그 사이즈 제한으로 JFlow에서 NOK 처리됨 (실제 작업은 정상 수행 중)
3. **실제 로그 확인 불가**: 파드 내부에서 어떤 작업이 수행되었는지 JFlow에서 확인할 수 없음

---

## 해결 방법 (TO-BE)

```bash
argo submit loop-sequence.yaml --watch --log | sed -r "s/\x1b\[[0-9;]*[mGKH]//g"
```

### 변경 사항

| 옵션 | 설명 |
|------|------|
| `--log` | 상태 갱신 대신 **실제 파드 내부 로그**를 출력 |
| `sed -r "s/\x1b\[[0-9;]*[mGKH]//g"` | ANSI 이스케이프 코드(색상, 특수문자) 제거 |

### 결과

![개선 후 로그 화면](/assets/images/Pasted%20image%2020260228171342_63142561.png)

---

## 개선 효과

| 항목 | 개선 전 | 개선 후 |
|------|---------|---------|
| 로그 내용 | 상태 갱신 반복 | 실제 작업 로그 |
| 8시간 작업 로그 크기 | 270MB+ | 대폭 감소 |
| JFlow 작업 상태 | NOK (로그 초과) | 정상 완료 |
| 디버깅 가능 여부 | 불가능 | 가능 |

---

## 적용 현황

**2025년 1월 운영 적용 완료**
