---
title: "첫 GO 중 GitLab 이슈 (공모주 메이트)"
date: 2024-01-26
tags:
  - Git
  - CI/CD
  - 개발
  - 이슈정리
category:
  - 실무경험
  - 기술
---

공모주 메이트 서비스 첫 운영 배포(GO) 과정에서 GitLab 연동 관련 발생한 이슈들 정리.

---

### 1. Approved 태그 수동 생성

ITSquare와 연동된 MR 처리 흐름은 다음과 같다.

```
MR 요청 → 검토자 코드리뷰 → 승인자 코드리뷰 후 Approved 태그 생성
→ MR 완료 → Approved 태그 감지 → 파이프라인 기동
```

파이프라인은 `Approved` 태그를 훅으로 감지하여 실행되는 구조인데, **Community 버전에서는 승인자가 해당 태그를 직접 수동으로 생성**해야 하는 불편함이 있다.

ITSquare 연동을 위해 불가피하게 선택한 구조로, 유료 버전에서도 별도의 해결 방안이 마련되어 있지 않아 당분간은 수동 운영 방식으로 유지한다.

---

### 2. 파이프라인 실행 권한

현재 개발자는 개발·스테이징 파이프라인 재실행 권한이 없다. 운영 파이프라인에 권한이 없는 것은 타당하나, 개발·스테이징 파이프라인이 실패했을 때 재실행이 필요한 상황에서 개발자가 직접 대응할 수 없는 문제가 있다.

**원인**: GitLab에서 파이프라인 실행 권한만 개별 부여하는 것이 불가능하다. 해당 권한을 갖기 위해서는 SRE 권한이 필요한데, SRE 권한에는 다른 프로젝트에 접근할 수 있는 불필요한 권한이 포함되어 있어 부여하기 어렵다.

**임시 조치**: GO 전까지 개발자 한 명이 SRE 권한을 임시로 보유하여 파이프라인 재실행을 담당.

**근본 해결 방향**: GitLab 유료 버전으로 전환 시 권한을 세분화하여 개발·스테이징 파이프라인 재실행 권한만 개발자에게 부여할 수 있도록 개선 예정.

---

### 3. ITSquare 연동 — Branch 반려 이슈

ITSquare와 연동된 Branch 생명주기는 아래와 같다.

```
main
  └─ CHA 브랜치 생성 (변경관리 단계 진입, main 기준 1:N)
       └─ PKG 브랜치 생성 (담당 개발자 지정, CHA 기준 1:M)
            └─ PKG에서 개발 진행 (Commit)
            └─ CHA로 Merge Request (스테이징 배포)
       └─ 단위테스트 완료 후 결재 → PKG to CHA Merge
  └─ 통합테스트 완료 후 사용자테스트 단계 진행
  └─ 사용자테스트 완료 후 배포 → CHA to main Merge
```

**문제 1 — 개발 단계 반려 시 브랜치 초기화**

개발 단계로 반려될 경우 기존 브랜치가 삭제되고 이름만 같은 새 브랜치가 생성된다. 이름은 동일하지만 내부 태그 정보가 달라 기존 Merge Request 이력을 수동으로 다시 적용해야 한다.

**문제 2 — 변경계획 단계 반려 시 CHA 브랜치 소실**

변경계획 단계로 반려되면 CHA 브랜치가 삭제되고 `main` 기준으로 초기화된 새 브랜치가 생성된다. 기존에 CHA에 머지되어 있던 개발 내용이 전부 사라지는 문제가 발생한다. (Merge Request 기록은 남아 있으므로 복원은 가능하나, 재머지 작업이 필요하다.)

**원인**: ITSquare는 변경계획 단계 진입 시 해당 브랜치가 신규인지 반려된 것인지 구분하지 않고 무조건 삭제 후 재생성하는 방식으로 설계되어 있다.

**개선 방안**:
- GitLab API에서 브랜치 생성 시 동일 이름이 이미 존재하면 409 에러가 반환된다. 이를 catch하여 브랜치를 삭제하지 않고 ITSquare의 태그 정보만 갱신하는 방식으로 수정하는 것이 적절하다.
- 또는 반려 프로세스 자체를 없애고 요구사항 변경 프로세스를 통해 처리하는 방안도 검토 가능하다.

---

### 4. CI — GitLab Runner ConfigMap 커스터마이징 이슈

**AS-IS**

배포 파이프라인 실행 시 Dockerfile이나 클러스터용 YAML 파일이 애플리케이션 브랜치에 없는 구조였다. 새 프로젝트 추가 시 SRE팀에서 파이프라인, 도커 이미지, ConfigMap 등을 직접 설정해야 했다.

**문제점**

- 웹서버 프로젝트는 환경변수 패턴이 단순하지만, 배치 애플리케이션은 Control M 입력 변수 → kubectl YAML → Dockerfile 변수로 이어지는 구조라 경로·환경변수 설정에 제약이 많다.
- 배치 1건당 pod 1개인 구조에서 개발자가 늘어날수록 SRE팀이 모든 설정을 감당하기 어렵다.
- 파이프라인에 들어가는 변수 중 공통 항목은 자동으로 주입하고, 커스터마이징이 필요한 항목은 개발자가 로컬 Dockerfile이나 YAML을 통해 직접 조정할 수 있는 구조가 필요했다.

**해결 (2024-05)**

SRE팀에서 Helm Chart를 활용하여 환경변수·Dockerfile 등 구성을 표준화하고, 개발자가 일정 범위 내에서 커스터마이징할 수 있도록 구조를 개선했다.
