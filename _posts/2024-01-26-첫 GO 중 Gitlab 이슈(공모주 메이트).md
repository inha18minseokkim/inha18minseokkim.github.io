---
title: "첫 GO 중 Gitlab 이슈(공모주 메이트)"
date: 2024-01-26
tags: [미지정]
category: 재테크
---

### 태그 수동 생성

ITSquare와 연동 시 MR요청 → 검토자가 코드리뷰 → 승인자가 코드리뷰 후 MR Approved 태그 남김 → MR → 파이프라인 기동되는 구조
MR 완료 후 파이프라인 돌때 Approved라는 Tag를 보고 훜을 걸어서 파이프라인이 돔
하지만 Community 버전이라 승인자가 Approved라는 태그를 직접 수기로 생성해줘야함(…)
  - 올해 Gitlab 구매 후에 바꾸던지 해야함
  - ⇒ 이건 그냥 it스퀘어랑 연동하려고 이렇게 된거라 어쩔 수 없겠다… 유료버전에서도 뭐 딱히 없음

### 파이프라인 개발자 권한

현재 개발자가 개발/스테이징 파이프라인을 돌릴 수 있는 권한이 없음. 운영 파이프라인은 당연히 권한이 없는것이 맞는데 개발, 스테이징 MR 후 파이프라인 실패 시 다시 돌리고 싶을 때가 있음(ITSquare 연동 실패 시 또는 그냥 파이프라인이 실패하는 경우)
  - 현재는 개발자 권한에 파이프라인만 넣을 수가 없음. 되게 하려면 권한을 개발자가 아닌 SRE로 가져와야되는데 그러면 불필요한 권한(Gitlab의 다른 프로젝트 건드는 권한들)을 가질 수 있어서 안됨
    - 일단 Gitlab 구매하면 권한 세분화 가능하다고 함
    - 임시로 GO 전까지 개발자 한사람이 SRE 권한을 가지고 있기로 함(파이프라인 Rerun용)
    - 그리고 파이프라인이 안정화되면 쓸일이 별로 없을 것 같기도 함. 현재는 보안성심의 관련해서 좀 건드는게 많아서 파이프라인 오류 자주나서 그런 것
  - 나중에는 개발/스테이징까지는 개발자가 파이프라인 권한 가질 수 있게 해야함
    - 그래야 편하지

### 기존 ITSquare와 연동 문제 - Branch

main → 어플리케이션 변경관리 단계 시 main 하위 CHA-Branch 생성 (1:N) 
→ 변경계획 하위 담당개발자 지정 후 각각의 CHA 하위 PKG-Branch 생성 (1:M) 
→ PKG Branch에서 개발 진행(Commit 가능) 
→ CHA Branch로 Merge Request(및 스테이징 배포) 
→ 개발 및 단위테스트 수행 후 (ITSquare) 결재(이 시점에 PKG to CHA MERGE) 
→ 통합테스트 끝난 후 결재 눌러서 사용자테스트 단계 감 
→ 사용자 테스트 후 배포 하면 CHA to main Merge 된다.

문제는 개발단계로 반려를 쳐버리는 경우 이미 Branch 는 지워진 상태이고 이름만 같은 Branch가 만들어짐
  - 이름은 같은데 태그정보가 다른 Branch가 만들어져서 다시 merge 후 단계 타야됨
변경계획단계로 반려되는경우 CHA Branch가 사라지고 새로만들어짐
  - main에서 내려받았던 Branch 그대로 초기화됨(개발건 다사라짐)
  - 물론 merge request 한 태그 기록이 남아있어서 살릴 수는 있지만 다시 merge 작업해줘야함.
ITSquare입장에서는 변경계획단계로 진입했을 때 이 Branch가 기 존재하던 Branch 인지 새것인지 모르므로 그냥 날려버리고 새로 만드는식으로 만드는것 같은데
  - 기존 형상 사용하던 개발자 입장에서는 익숙하지 못함(기존에는 반려하고 개발내용 수정안하더라도 그냥 가면되는데 현상황에서는 그렇게 못함)
→ GITLAB Api 에서 Branch 생성 후 해당 이름이 기 존재시 에러 로그 출력하던데 무조건 branch 지우지 말고 이걸 catch 해서 다시 ITSquare에 태그정보 갱신하는 식으로 만들어야할듯
→ 또는 아예 반려 못쓰게하고 요구사항변경 프로세스를 타도록 하던가.


### CI - GITLAB Runner - ConfigMap(?) Customize 이슈

ASIS
  - Action 하는 Branch에 DockerFile이나 클러스터용 yaml 파일 없음. 실제로 새로운 프로젝트가 따지면 SRE쪽에서 pipeline 및 도커 이미지, 환경변수에 들어가는 ConfigMap 같은것을 파이프라인에서 넣어줘야함
문제점
  - 웹서버 프로젝트의 경우 단위업무당 한두건이고 환경변수가 없거나 있어도 공통 패턴을 보일텐데 배치 어플리케이션을 감싸는 pod의 경우 Control M에서 추가하는 입력변수 → kubectyl apply 될 yaml → DockerFile의 변수 이런식으로 만들어짐
    - 그럼 파일 경로같은 환경변수 설정하는데 제약이 많을듯
  - 그리고 배치 한건당 pod 하나라서 개발자 많아지면 이거 SRE 두명이서 다 못함
그러므로 파이프라인에 들어가는 변수들 중 공통적인 부분은 파이프라인 돌면서 inject 하던지 하고 커스터마이즈 할 수 있는 방법이 필요하다. 로컬에 DockerFiles나 Customize 할 수 있는 yaml을 둔다거나 해서 일정부분 손볼 수 있어야 할듯
⇒ SRE 분께서 helm chart를 활용하여 환경변수 도커파일 등 구성 완료(202405)
