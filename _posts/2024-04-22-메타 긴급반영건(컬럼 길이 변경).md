---
title: 메타 긴급반영건(컬럼 길이 변경)
date: 2024-04-22
tags:
  - 케이뱅크
  - 주식서비스
  - 인프라
  - 이슈정리
category:
  - 실무경험
  - 비상장주식알림서비스
---

운영 환경 첫 데이터 적재 시 Numeric 타입 overflow가 발생하여 컬럼 길이를 긴급 변경한 내용 정리.

---

### 발생 경위

주식 변동률 데이터를 적재하는 과정에서 `Numeric(7,4)` 타입의 컬럼에 `1100.00%`와 같이 예상 범위를 초과하는 값이 들어오면서 overflow가 발생했다. 변동률 최대값을 보수적으로 설계한 것이 원인이었다.

**조치**: `Numeric(7,4)` → `Numeric(19,2)` 로 컬럼 타입 긴급 변경.

---

### 원인 분석

**1차 원인 — 테스트 케이스 미흡**

- 컬럼 타입 설계 시점에 허용 범위를 충분히 검토하지 않았다.
- 비상장주식의 경우 수백~수천 % 수준의 급등락이 발생할 수 있는 자산 특성을 설계에 반영하지 못했다.
- 초기 설계 단계에서 여유 있는 타입(`Numeric(19,2)`)으로 잡았어야 했다.

**2차 원인 — 운영 환경에서의 첫 실데이터 검증**

외부 파트너사의 API가 IP 방화벽으로 보호되어 있어, 아래와 같은 환경 제약이 있었다.

- 파트너사 측: 운영 URI 접근 시 행내 서버 IP만 허용 (로컬 개발 환경에서 직접 호출 불가)
- 행내 측: 마찬가지로 방화벽 적용, 보안성 심의 완료 전까지 운영 연동 불가

이 구조로 인해 **스테이징 환경에서 실데이터 기반의 충분한 검증을 수행하지 못한 채** 운영 오픈을 맞이하게 됐고, 결과적으로 스테이징 단계에서 잡혔어야 할 이슈가 운영에서 발견됐다.

---

### 회고

외부 연동 구조상 로컬 및 스테이징 환경에서 실데이터 검증이 어려운 경우, 컬럼 타입·길이 등 데이터 스펙은 실제 도메인 특성을 반영하여 넉넉하게 설계하는 것이 중요하다. 특히 변동성이 큰 자산 데이터의 경우 극단값에 대한 사전 검토가 필요하다.
