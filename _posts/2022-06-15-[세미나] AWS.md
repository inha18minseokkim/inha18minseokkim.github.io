---
title: "[세미나] AWS"
date: 2022-06-15
tags: [미지정]
category: 실무경험
---
아파트 시대별: 시대별로 기술 다름, 규모 다름
서버기술 발전이 가장 큰 영향..
메인프레임 → 가상화 → 클라우드
WaterFall → Agile 
시대상이 아키텍쳐에 많이 녹아있음

의존성 - 
세부 프로세스 모듈로 구성됨. 과거에는 한 서버의 인스턴스로 처리하는데 요즘은 MSA로 처리
 과거에는 하나의 트랜잭션, 요즘에는 의존성 있는 시스템끼리 처리하도록 함. 오류가 발생하더라도 롤백이 아니라 resilience하게 처리할지에 대해논의
주문 프로세스가 식당모듈,부엌모듈,주문받는모듈에 의존성 생김
기존 모놀리식 아키텍쳐 단점 - 하나가 fail시 모두 fail 가능
라이브러리는 라이브러리대로 배포, 변경되는것에 상관없이 배포 가능. 변경가능성에 대해 대비 가능
rest는 스프링, 배치는 파이썬
LG엔솔 사례 - 상장할때 트래픽 많으니 상장 때문에 총자산현황,전계좌현황 같은 서비스를 차단함. 핵심 기능을 위해 비핵심기능이 희생될수도.
빅테크 기업들은 새로운 서비스 출시주기가 상당히 빠름
rough)모듈이 서버로 내려가고 library call 이 아닌 api call 방식으로 바뀜
db를 서비스단으로 잘게 자름

시스템의 복잡도에 따라 MSA가 능사는아님
시스템이 작으면 MSA가 힘들 수 있다. 조직이 커지고 서비스 규모가 늘어나 복잡도가 늘어날 때

API GATEWAY - 프록시처리(versioning), 트래픽 관리
이벤트 메세지 큐 - 준실시간 처리. 실시간해야하는데요? 그럴일이 거의 없긴함 ㅇㅇ.. 최종적인 완결성?
데이터 정합성 깨지지 않나? - 기존 모놀리식 방법의 경우 중요한데 어차피 db가 쪼개졌기 때문에 별상관없음. 프로세스 단위로만 처리하면됨

CQRS Pattern - 유저별로 테이블 스키마가 달라져야할 수 있음(ORM에서 비밀번호 같이 있으면 안되는 데이터 배제 가능) NoSQL 쓰기도 함

트랜잭션
예전에는 주문 하나가 트랜잭션으로 묶여서 테이블 쓰고 완료되면 풀고 이런식으로 했음.
네트워크 + nonblocking이면 트랜잭션 유지 어떻게함??
→ 단일 서비스 내 트랜잭션은 기존 방식과 동일
→ 복수 서비스들이 일관성을 유지할 수 있는 전략 수립
→ 거의 대부분의 서비스에서 동시성을 요구하진 않는다.
분산 트랜잭션(SAGA) 
Choreography - 바통 넘기듯이 서비스끼리 다 한번씩 바통을 돌려받음. 릴레이하다 넘어지면 넘겨받은 사람에게 롤백 처리
Orchestration - saga orchestrator가 msa들의 동작을 스케줄링한다. 집중되서 힘들긴 한데 문제가 생겨도 어디서 문제가 생기는지 알 수 있다.

아키텍쳐 뿐만아니라 개발이나 운영조직의 구성원 또한 따라가야함
문돌이와 공돌이간의 언어 통일이 중요

이벤트 스토밍 - 한 자리에 다 모여서 이벤트 사이클에 대해 논의. 각 단계별로 도메인을 나눠서 모듈을 만듬.
너무 잘게 쪼개도 불편하긴함. trade off 찾아내는게 중요
Big bang vs Strangler Pattern
→ Strangler Pattern : 가장 코어하지 않은것부터 가져가는것
test code coverage


EDA
메시지 versioning 가능, 인터페이스 종속 디커플링 가능
모든 이벤트는 독립적으로 저장할필요있음(히스토리)

어플리케이션 내에서 비동기처리(클래스간의 의존성)
→ DI보다도 더 느슨하게 하기 위해서 Spring Event
비교적 단순한 것 처리시 유용, 단점: 하나의 어플리케이션 context 내부에서 동작함. 확장 불가.

클러스터 내 비동기 처리(서버 내부에서 이벤트 받아 처리)
→ 확장가능, 특정 액터가 불능이어도 나머지가 처리가능

카프카를 외부 서비스 소통용 뿐만이 아니라 내부서비스간의 스케줄용으로도 사용가능

메세지의 주도권은 해당 컨테이너만. 메세지가 오면 받아서 처리. 내 메세지 내가 알아서.

지연된 일관성 → db간 정합성 체크를 해야하나? 그럴 필요 없다. 애초에 다른 업무 도메인 이야기임
카프카 문제 - 메세지가 크면 클수록 성능 떨어짐

AOM패턴 - 데이터베이스의 property 명과 해당 테이블을 만들어서 저장 → 테이블간의 join 어려워 → 쿠팡은 NoSQL로 바꿈

웹소켓 구독하고 버퍼로 받는거랑 메세지큐랑 차이가 뭘까

하둡 처리 하는게 그 빅데이터 
스냅샷을 메세지 버전 기준으로 유지시키는게 맞음?

클라우드에서 replica처리 하는게 맞음..
스냅샷과 재적재 전략
