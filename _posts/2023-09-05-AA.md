---
title: "케이뱅크 MSA 전환을 위한 과제(IDC연동 및 패키지 구조)"
date: 2023-09-05
tags: [MSA]
---

## 기술 스택

- **Nexus**: Maven Repository 관리
- **API 통신**: WebFlux 내 WebClient 사용
- **Validation**: Hibernate Validation 사용
- **모니터링**: Region 이슈로 Datadog 사용 불가 → **Sentry**로 로그 수집
- **Object Mapper**: Jackson + Lombok 조합 — 사실상 표준
  - 프로젝트 규모가 커지면 Lombok으로 인한 빌드 시간 증가 이슈 발생 가능

---

## 모듈 구조: 멀티 vs 싱글

### 문제 인식

- **Gradle 멀티 모듈**: dependency 문제가 있다고 주장하는 사례 존재
- **싱글 모듈로 전환 시**: 코드성 모듈·매핑 모듈 등에서 필연적으로 중복 코드 발생
  - 결국 공통 라이브러리를 별도 제작·배포하거나, 표준화 전담 프로젝트를 따로 만들게 됨

### 채택 방식

- **멀티 모듈 기본, 대부분은 싱글로 분리** — 공통 기능(비즈니스 제외)만 멀티 모듈로 관리
- 네이밍 컨벤션: `{업무도메인}.{기능계층}`

### 공통 모듈 설계 원칙

- `common`과 `framework`를 분리하지 않는다면, 공통 비즈니스는 config 영역으로 관리 가능
- 공통 모듈을 싱글 노드로 두고 유틸을 중복 선언하면, 유틸 수정 시 전체를 일괄 변경해야 하는 문제 발생
  - 대안: Gradle `implementation`으로 라이브러리 패키징·배포하거나, 수동으로 일일이 변경
- 실제 사례: 초기에 공통 모듈을 만들어 두고 이후 각 팀이 독자적으로 진화하는 방식으로 운영됨
- 스파게티 코드 방지를 위해 `cmn` 모듈에는 **정적이고 메이저하지 않은 요소만** 배치
  - 권한을 제한하고 AA만 수정 권한을 갖는 방식으로 관리

---

## JPA / 엔티티 설계

- **JPA Entity를 cmn 모듈에 배치한 사례**: DAO(Repository)를 한 폴더에 집중시켰으나, 각 담당자가 자기 엔티티를 각자 만들어 테이블 하나에 엔티티 여러 개가 분산되는 문제 발생
- **DTO · Entity · Domain 분리**: Entity는 순수 ORM 엔티티, Domain은 QueryDSL 전용으로 역할 구분
- `Request` / `Response`는 Controller의 Inner Class로 선언하는 방식도 고려해볼 만함

---

## 기타 기술 선택

- **Join Point가 많은 경우**: 함수형 스타일에서는 JPA보다 MyBatis가 훨씬 유리

---

## MCI 채널 이슈

### 배경

- 과거 창구 단말 → 중앙 서버 구조에서 MCI(Multi Channel Integration)가 중간 변환 계층으로 사용됨
- 앱·인터넷 뱅킹 전환 이후 멀티 채널 대응을 위해 MCI가 필요했으나, 현재는 REST API + HTTP 호출로 대부분 해결 가능한 상황에서도 레거시로 남아 있음

### 기술적 문제

- MCI 전문 스펙이 POST 기반 통신으로 고정되어 있음
  - body에만 데이터가 있고, query param이나 path variable 없이 `/crd/serialized`, `/crd/fixedlength` 두 엔드포인트로만 통신
- 쿠버네티스 Ingress에서 Pod/Server 레벨 버전 관리를 하려면 body를 파싱해 v1/v2를 판별해야 함
  - 게이트웨이에 소스 코드가 과도하게 집중되는 문제 발생
- 네이버의 동남아 은행 프로젝트는 OAuth + JSON 통신으로 전면 전환했으나, 이 케이스는 아직 전환 불가

### 현황

- 채널 쪽에서 신규 건은 MCI 제외 방향으로 점진적 개선 추진 중
- 토스는 신규 쿠버네티스 환경에서 MCI 제거 — 기존 LG 인프라에는 MCI 잔존
