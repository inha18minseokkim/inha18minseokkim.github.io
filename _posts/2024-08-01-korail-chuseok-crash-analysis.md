---
title: "추석 KTX 예매 시 코레일이 터진 이유에 대한 추측"
date: 2024-08-01
tags: [아키텍처, 인프라, 삽질, 장애분석]
---

추석 대구행 KTX를 예매하면서 재미있는 관찰을 했다.

## 상황

9월 17일 추석에 대구로 내려가는 KTX를 예매해야 했다. 동생도 같이 예매 도전.
동생은 하필 스튜어디스 연수를 김포공항으로 가라고 해서 10월 4일 하행 티켓을 예매해야 했음.

수강신청 경험을 살려 서버시간 기준으로 땡! 하고 동시 진입:

- **동생**: iOS Safari
- **나**: macOS Chrome + Android Chrome 동시에 누름

**결과:**
- 동생: 대기열 접속 페이지 자체를 못 들어감 (네트워크 통신 실패)
- 나: macOS Chrome 성공 (9800번대 대기열 → 10분 안에 예매 완료), Android Chrome 실패 (대기열 접속 실패)
![[Pasted image 20260219230925.png]]
![[Pasted image 20260219230931.png]]



---

## 분석

### 관찰 1: 모바일 실패, 데스크톱 성공

동생(iOS)도 실패, 내 Android도 실패, 내 macOS Chrome만 성공.

**추측:** 모바일 웹 서버와 데스크톱 웹 서버가 분리되어 있다.

이는 일반적인 대용량 트래픽 처리 패턴이다. 모바일 사용자가 훨씬 많으니 모바일 프론트 서버에 트래픽이 집중되어 모바일 쪽만 터진 것으로 보인다.

### 관찰 2: 코레일이 이번에 웹서버를 신규 구축했음

근거 1. 작년과 다르게 올해 ui가 많이 바뀜
근거 2. 장애가 나고 대응에 시간이 상당히 오래 걸림

기존 레거시 시스템에서 새 인프라로 전환하면서 모바일/데스크톱 서버 사이즈 배분을 잘못 잡았을 가능성.
### 관찰 3: WAS는 일원화되어 있지 않을까

근거 1. 안그러면 예매할 때마다 db 동시성 문제가 생길것
근거 2. WAS를 보호하기 위해 별도의 웹 서버들을 두고 있지 않을까

프론트 서버(정적 파일, 대기열 진입)는 나뉘어 있더라도, 실제 예매 처리 WAS는 하나로 통합되어 있을 가능성이 높다.

---

## 아키텍처 추측

![[Pasted image 20260219231036.png]]
추석 예매 오픈 시 트래픽:
- 모바일 사용자: 훨씬 많음 (대부분 스마트폰으로 접속)
- PC 사용자: 상대적으로 적음

### Case 1. 대기열을 진입하기 위해 만들어진 페이지도 접속 못함

대기열은 공정해야하니깐 아마 큐는 하나일 것이고(물리적인거 말고 논리적으로, 레디스도 그냥 예시임)

![[Pasted image 20260219231135.png]]

보통 7시에 데스크탑보다는 모바일로 들어가는 사람들이 월등히 많을 것, 모바일용 웹 서버가 터져버리는 바람에 사람들이 대기열 접속 자체를 못해버렸다.(이번에 블라인드에 이거 관련 글이 제일 많았음)

![[Pasted image 20260219231149.png]]

이 페이지 다음에 예매하기 버튼을 눌러야 큐 접속이 되는데 시도조차 못하고 짤막당한 케이스

여기서 들어가지도 못하는 사람들

하지만 나처럼 모바일로 안들어가고 데탑으로 들어간 사람은 다행히도 대기열에 들어갔음

### Case 2. 대기열 진입하고 이제 진입해야하는데 팅긴 케이스
![[Pasted image 20260219231201.png]]
큐 진입 후 세션 할당을 못받아서 팅기는 케이스도 있었음, 만약 모바일 웹이 같은 인스턴스라면 또는 대기열 뒤의 모바일 웹 세션 할당 수 계산을 잘못했다면 이렇게 될 수도 있을 듯.

![[Pasted image 20260219231211.png]]

여기서 멈추거나 통신장애로 팅기는 사람들은 다시 들어가야한다

![[Pasted image 20260219231218.png]]

> > 제일 빡침, 숫자 할당받아서 다 기다렸는데 숫자가 0 되자마자 팅긴기거나 그냥 기다리다 팅긴거라 다시 들어가면 앞에 100만명 있음.

### Case 3. 예매페이지까지 들어갔는데 조회가 안되고 3분 지나서 다시 팅김

![[Pasted image 20260219231228.png]]

이런식으로 대기열을 다 뚫고 들어갔는데도 조회를 못해서 실패하는 경우도 있다. 그럼 대기열을 왜만들었을까..

![[Pasted image 20260219231237.png]]

![[Pasted image 20260219231244.png]]

### Case 4. case 1에서 대기 페이지도 못들어갔는데 여기에는 별도의 세션 관리가 없었던것 같음

![[Pasted image 20260219231250.png]]

이렇게 대기열 진입도 못한 사용자들은 한동안 진입 자체를 못했음, 반대로 성공한 사람(나) 는 3시간동안 세션을 물면서 계속 대기열 진입 시도함

![[Pasted image 20260219231257.png]]

대기열을 진입하기 위해 대기하는 페이지에서 세션이 단 한번도 안끊기고 대기열을 다섯번이나 진입해서 예매 페이지를 다섯 번이나 들어감

반대로 내 휴대폰은 대기열을 진입하기 위해 대기하는 페이지를 한 번도 못들어감(계속 네트워크 오류 뜸)

대기열은 열심히 관리한 것 같은데(그럼에도 불구하고 대기열 후의 행위에 영향을 미치면 안됐을것)

대기열을 진입하는 페이지 접근을 못한건 신박했음

### 클라우드광신론) AWS + MSA 였다면

![[Pasted image 20260219231306.png]]

웹서버 > 그냥 웹서버는 서버리스로 정적인 리소스만 보여줘버림 더 필요하면 돈 더 태워서 증설

대기열 > ElastiCache로 가용량 더 필요하면 돈을 더 태워서 증설하면됨

WAS > Kubernetes Pod 형태로 띄워서 가용량 더 필요하면 돈 더 태워서 증설하면됨

DB > 위랑 좀 감성이 다르긴 하지만 자원이 부족하면 돈 더 태우면 됨

물론 기존에 있던 시스템을 단 명절 예매 일주일을 위해서 클라우드에 올려야 하나..라는 의문이 있을 수는 있지만 WAS 영역은 기존 솔루션 그대로 사용하더라도 앞단은 그냥 클라우드에 올려서 평소에는 Scale Out 해놓고 명절에만 Scale up 하면 되지 않을까,..


---

## 결론

서버시간 기준으로 정확히 땡에 눌러도 어떤 디바이스로 접속하느냐에 따라 성공 여부가 갈린다는 걸 직접 경험했다. 수강신청 경쟁과 비슷하게, 모바일보다 PC 데스크톱이 유리한 셈이다.

나는 성공했지만 동생 티켓은 결국 못 잡았다...
