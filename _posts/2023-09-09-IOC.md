---
title: IOC
date: 2023-09-09
tags:
  - 개발
category: 기술
---
Inversion Of Control - 뒤집힌 제어권
자기 코드에 대한 제어권을 자신이 가지고 있지 않고 위에서 제어하는 경우
제어권 : 인스턴스 만들거나 어떤 메소드 실행, 필요로 하는 의존성 주입
클래스 메서드 그 자체가 stateless한 경우도 해당됨(설명 정확도 50%)

스프링 IOC 컨테이너
십수년동안 수많은 나보다 머리좋은 개발자들이 검증완료, 개선중
스프링 context 내에서 스코프 쉽게 관리 가능(바깥으로 벗어나면 안되지만..)
Bean관련 라이프사이클 인터페이스 제공
생성하자마자 데이터 초기화, 외부와 연결해서 뭔가 하거나 종료할 때 리소스 반납하거나 해야하는 설정 스프링이 챙겨줌
스프링은 POJO 지향.. 기존에 만든 클래스들 그냥 Configuration(@Configuration 어노테이션이 붙어있는 클래스)에 @Bean으로 등록하거나 그렇게 하면 스프링이 관리 가능. 침투적이지 않음

```java
@Configuration
public class AppConfig {
	@Bean
	public SpellChecker spellChecker(Dictionary dictionary) {
 //스프링이 관리하고 있는 딕셔너리 넘겨주면 스프링이 알아서 함
		return new SpellChecker(dictionary);
	}
	@Bean
	public Dictionary dictionary() {
		return new SpringDictionary();
	}
}
```


```java
public static void main(String[] args) {
	ApplicationContext applicationContext = new AnnotationConfigApplicationContext(AppConfig.class);
	SpellChecker bean = applicationContext.getBean(SpellChecker.class);
	}//new 말고 이렇게 가져와야 Spring 컨텍스트에서 인식 가능. 별다른 설정 없으면 싱글톤
```


귀찮으므로 우리는 @Component 같은 것을 annotate 해놓고 @ComponentScan 하면 자동으로 등록

```java
@Configuration
@ComponentScan(basePackageClasses = AppConfig.class)
public class AppConfig {

}
```



### 그럼 왜 static을 쓰지 않고 Singleton을 쓰는가

static은 객체를 만들지 않음(이건 그럴 수 있다쳐도) 
오버라이딩, 인터페이스 구현 불가능
컴파일 타임에 싹다 로딩(lazy load 안됨)
그러므로 저장위치는 힙이 아닌 스택
state in static class is nightmare - 동시성 환경에서 race condition 문제


DAO를 static이 아닌 싱글톤으로 구현하는 이유?
[https://okky.kr/questions/583814](https://okky.kr/questions/583814)
요약 : 구현의 편리성
> [https://stackoverflow.com/questions/519520/difference-between-static-class-and-singleton-pattern](https://stackoverflow.com/questions/519520/difference-between-static-class-and-singleton-pattern)

---

## Q. DAO를 Singleton으로 쓰는 이유?

DAO는 상태(state)를 가지지 않는 stateless 객체다. 1000명이 동시 접속해도 DAO 인스턴스 자체에 요청별 데이터를 저장하지 않고, DB 커넥션만 커넥션 풀에서 받아 사용한다. 즉, 인스턴스를 매번 새로 생성할 필요가 없다.

- 서블릿도 인스턴스 하나만 생성되는 싱글톤이며, 요청마다 스레드가 생성될 뿐이다
- 싱글톤 DAO는 커넥션 풀을 통해 여러 커넥션을 관리하고, 각 스레드는 서로 다른 커넥션을 받아 처리한다
- "특정 브라우저의 중복 호출 방지"와는 무관하다. 싱글톤은 JVM당 인스턴스 하나라는 의미다
- 핵심은 **구현 편의성**: static으로 구현하면 인터페이스 구현·오버라이딩이 불가능하고 테스트가 어렵다. 싱글톤은 이 문제를 해결하면서 인스턴스 낭비도 막는다

## Q. Static class vs Singleton pattern의 차이

`static`은 언어 키워드, `Singleton`은 디자인 패턴이다.

| 항목 | Static class | Singleton |
|---|---|---|
| 인스턴스 생성 | 불가 | 가능 (1개) |
| 인터페이스 구현 | 불가 | 가능 |
| 상속 / 다형성 | 불가 | 가능 |
| Lazy 초기화 | 불가 (클래스 로드 시 초기화) | 가능 |
| GC 대상 | 아님 (High-Frequency Heap) | 됨 (일반 Heap) |
| 파라미터로 전달 | 불가 | 가능 |
| 테스트 / Mock | 어려움 | 용이 |
| 의존성 주입 | 불가 | 가능 |

**핵심 차이**: Singleton은 인터페이스를 구현하고 다형성을 활용할 수 있다. 스프링 Bean이 static 대신 싱글톤인 이유도 이 때문이다. AOP, DI, 테스트 등 스프링의 핵심 기능이 모두 인스턴스 기반으로 동작한다.

> 함수 묶음만 필요하다면 static, 상태 관리·인터페이스·DI가 필요하다면 Singleton을 선택하라.
